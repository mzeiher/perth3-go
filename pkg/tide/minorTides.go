package tide

import "fmt"

func InferMinorTides(h12 [][]float64) ([][]float64, error) {
	if len(h12) != 2 && len(h12[0]) != 28 {
		return nil, fmt.Errorf("invalid length")
	}

	// shift tides to the end (see perth3.f)
	h12[0][26] = h12[0][3]
	h12[1][26] = h12[1][3]
	h12[0][27] = h12[0][9]
	h12[1][27] = h12[1][9]
	h12[0][3] = h12[0][4]
	h12[1][3] = h12[1][4]
	h12[0][4] = h12[0][5]
	h12[1][4] = h12[1][5]
	h12[0][5] = h12[0][6]
	h12[1][5] = h12[1][6]
	h12[0][6] = h12[0][7]
	h12[1][6] = h12[1][7]
	h12[0][7] = h12[0][8]
	h12[1][7] = h12[1][8]

	// infer minor tides at this location also see perth3.f
	h12[0][8] = 0.263*h12[0][0] - 0.0252*h12[0][1]
	h12[1][8] = 0.263*h12[1][0] - 0.0252*h12[1][1]
	h12[0][9] = 0.297*h12[0][0] - 0.0264*h12[0][1]
	h12[1][9] = 0.297*h12[1][0] - 0.0264*h12[1][1]
	h12[0][10] = 0.164*h12[0][0] + 0.0048*h12[0][1]
	h12[1][10] = 0.164*h12[1][0] + 0.0048*h12[1][1]
	h12[0][11] = 0.0140*h12[0][1] + 0.0101*h12[0][3]
	h12[1][11] = 0.0140*h12[1][1] + 0.0101*h12[1][3]
	h12[0][12] = 0.0389*h12[0][1] + 0.0282*h12[0][3]
	h12[1][12] = 0.0389*h12[1][1] + 0.0282*h12[1][3]
	h12[0][13] = 0.0064*h12[0][1] + 0.0060*h12[0][3]
	h12[1][13] = 0.0064*h12[1][1] + 0.0060*h12[1][3]
	h12[0][14] = 0.0030*h12[0][1] + 0.0171*h12[0][3]
	h12[1][14] = 0.0030*h12[1][1] + 0.0171*h12[1][3]
	h12[0][15] = -0.0015*h12[0][1] + 0.0152*h12[0][3]
	h12[1][15] = -0.0015*h12[1][1] + 0.0152*h12[1][3]
	h12[0][16] = -0.0065*h12[0][1] + 0.0155*h12[0][3]
	h12[1][16] = -0.0065*h12[1][1] + 0.0155*h12[1][3]
	h12[0][17] = -0.0389*h12[0][1] + 0.0836*h12[0][3]
	h12[1][17] = -0.0389*h12[1][1] + 0.0836*h12[1][3]
	h12[0][18] = -0.0431*h12[0][1] + 0.0613*h12[0][3]
	h12[1][18] = -0.0431*h12[1][1] + 0.0613*h12[1][3]
	h12[0][19] = 0.264*h12[0][4] - 0.0253*h12[0][5]
	h12[1][19] = 0.264*h12[1][4] - 0.0253*h12[1][5]
	h12[0][20] = 0.298*h12[0][4] - 0.0264*h12[0][5]
	h12[1][20] = 0.298*h12[1][4] - 0.0264*h12[1][5]
	h12[0][21] = 0.165*h12[0][4] + 0.00487*h12[0][5]
	h12[1][21] = 0.165*h12[1][4] + 0.00487*h12[1][5]
	h12[0][22] = 0.0040*h12[0][5] + 0.0074*h12[0][6]
	h12[1][22] = 0.0040*h12[1][5] + 0.0074*h12[1][6]
	h12[0][23] = 0.0131*h12[0][5] + 0.0326*h12[0][6]
	h12[1][23] = 0.0131*h12[1][5] + 0.0326*h12[1][6]
	h12[0][24] = 0.0033*h12[0][5] + 0.0082*h12[0][6]
	h12[1][24] = 0.0033*h12[1][5] + 0.0082*h12[1][6]
	h12[0][25] = 0.0585 * h12[0][6]
	h12[1][25] = 0.0585 * h12[1][6]
	return h12, nil
}
